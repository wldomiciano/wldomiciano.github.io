<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><title>Métodos obsoletos da HttpSecurity no Spring Security 6.1</title>
<meta name=description content='Alguns métodos da HttpSecurity tornaram-se obsoletos no Spring Security 6.1. Conheça as alternativas e veja dicas de utilização'><meta name=keywords content='Programação,Tutoriais'><link rel=stylesheet href=/assets/main.css><link rel=stylesheet href=/assets/molokai.css><link rel=canonical href=https://wldomiciano.com/metodos-obsoletos-da-httpsecurity-spring-security-6-1/><link rel=alternate type=application/rss+xml title="Wellington Domiciano" href=/index.xml><style>.video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.video-responsive iframe{left:0;top:0;height:100%;width:100%;position:absolute}</style><script>window.doNotTrack==="1"||navigator.doNotTrack==="1"||navigator.doNotTrack==="yes"||navigator.msDoNotTrack==="1"||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-48568115-1","auto"),ga("send","pageview"))</script></head><body><header class=site-header role=banner><div class=wrapper><a class=site-title rel=author href=https://wldomiciano.com/>Wellington Domiciano</a></div></header><main class=page-content aria-label=Content><div class=wrapper><script type=application/ld+json>{"@context":"https://schema.org","@type":"blogPosting","datePublished":"2023-07-29","dateModified":"2023-07-29","name":"Métodos obsoletos da HttpSecurity no Spring Security 6.1","headline":"Alguns métodos da HttpSecurity tornaram-se obsoletos no Spring Security 6.1. Conheça as alternativas e veja dicas de utilização","author":{"@type":"Person","name":"Wellington Domiciano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wldomiciano.com\/"},"publisher":{"@type":"Organization","name":"Wellington Domiciano"}}</script><article class="post h-entry"><header class=post-header><h1 class="post-title p-name">Métodos obsoletos da HttpSecurity no Spring Security 6.1</h1><div class=post-meta>Postado em
<time class=dt-published datetime=2023-07-29>29/07/2023</time></div><div class=post-tag-list><a class=post-tag-item href=https://wldomiciano.com/tags/java/>Java</a>
<a class=post-tag-item href=https://wldomiciano.com/tags/spring-security/>Spring Security</a></div></header><div class="post-content e-content"><p>No Spring Security 6.1 vários métodos da classe <a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html target=_blank rel=noopener><code>HttpSecurity</code></a>
tornaram-se obsoletos e isto afeta projetos criados com Spring Boot a partir da
versão 3.1.</p><p>Métodos como <a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html#cors%28%29 target=_blank rel=noopener><code>cors()</code></a>, <a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html#csrf%28%29 target=_blank rel=noopener><code>csrf()</code></a>,
<a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/org/springframework/security/config/annotation/web/builders/HttpSecurity.html#authorizeHttpRequests%28%29 target=_blank rel=noopener><code>authorizeHttpRequests()</code></a>, etc&mldr; não devem mais ser usados, pois a
expectativa é de que sejam removidos no Spring Security 7.</p><p>O que devemos usar atualmente é a versão destes métodos que aceita um
<a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/org/springframework/security/config/Customizer.html target=_blank rel=noopener><code>Customizer</code></a> como argumento, o que a documentação chama de <em>Lambda
DSL</em>.</p><p>Então, o que antes seria configurado assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/blog/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>cors</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>and</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>csrf</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>disable</span><span class=p>()</span><span class=w>
</span></span></span></code></pre></div><p>Hoje deve ser feito assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span><span class=w> </span><span class=nn>org.springframework.security.config.Customizer.withDefaults</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customizer</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>customizer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/blog/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>cors</span><span class=p>(</span><span class=n>withDefaults</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>customizer</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>customizer</span><span class=p>.</span><span class=na>disable</span><span class=p>())</span><span class=w>
</span></span></span></code></pre></div><p>Este não é um jeito novo, pois está presente desde o Spring Security 5.2, que
saiu em 2019. Apenas o que era opcional, hoje é recomendado e logo será
requerido e uma das justificativas é de que o estilo de configuração antigo é
bastante confuso.</p><p>O uso do método estático <code>withDefaults()</code> indica que estamos ativando aquela
funcionalidade com suas configurações padrão, mas ele é opcional.</p><p>Você poderia usá-lo sem a importação estática.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.Customizer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>formLogin</span><span class=p>(</span><span class=n>Customizer</span><span class=p>.</span><span class=na>withDefaults</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span></code></pre></div><p>Ou apenas usando uma expressão lambda com o corpo vazio.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>httpBasic</span><span class=p>(</span><span class=n>customizer</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span></code></pre></div><p>E para desabilitar uma funcionalidade é possível usar <em>method references</em>, que
eu, particularmente, acho mais elegante.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>org.springframework.security.config.annotation.web.configurers.CsrfConfigurer</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ..</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>CsrfConfigurer</span><span class=p>::</span><span class=n>disable</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span></code></pre></div><p>Para mais informações, visite esta página da documentação oficial:</p><p><a href=https://docs.spring.io/spring-security/reference/migration-7/configuration.html target=_blank rel=noopener>https://docs.spring.io/spring-security/reference/migration-7/configuration.html</a></p><p>Embora eu tenha focado nos métodos da <code>HttpSecurity</code>, outras coisas se tornaram
obsoletas nesta versão e a lista completa esta na página abaixo.</p><p><a href=https://docs.spring.io/spring-security/site/docs/6.1.2/api/deprecated-list.html#method target=_blank rel=noopener>https://docs.spring.io/spring-security/site/docs/6.1.2/api/deprecated-list.html#method</a></p><hr><p>Vale destacar que para configurar o <code>HttpSecurity</code> não é necessário encadear os
métodos como nos exemplos acima. O mesmo resultado pode ser alcançado da
seguinte forma:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>http</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>authorizeHttpRequests</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>customizer</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>customizer</span><span class=p>.</span><span class=na>requestMatchers</span><span class=p>(</span><span class=s>&#34;/blog/**&#34;</span><span class=p>).</span><span class=na>permitAll</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>customizer</span><span class=p>.</span><span class=na>anyRequest</span><span class=p>().</span><span class=na>authenticated</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>http</span><span class=p>.</span><span class=na>cors</span><span class=p>(</span><span class=n>withDefaults</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>http</span><span class=p>.</span><span class=na>csrf</span><span class=p>(</span><span class=n>customizer</span><span class=w> </span><span class=o>-&gt;</span><span class=w> </span><span class=n>customizer</span><span class=p>.</span><span class=na>disable</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=n>http</span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>Assim, se você estiver com problemas para entender a Lambda DSL, fazer
invocações separadas como acima pode lhe ajudar a entendê-la melhor.</p></div><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://wldomiciano.com/metodos-obsoletos-da-httpsecurity-spring-security-6-1/",this.page.identifier="https://wldomiciano.com/metodos-obsoletos-da-httpsecurity-spring-security-6-1/"};(function(){var e=document,t=e.createElement("script");t.src="https://wldomiciano.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></article></div></main><footer class="site-footer h-card"><div class=wrapper><div class=footer-col-wrapper><ul class=social-media-list><li><a href=https://github.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"/></svg>
<span class=username>wldomiciano</span></a></li><li><a href=https://twitter.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"/></svg>
<span class=username>wldomiciano</span></a></li></ul></div></div></footer><script>if("serviceWorker"in navigator){const e=!0,t=["index","next","prev","prefetch"];function prefetchCache(){if(navigator.serviceWorker.controller){const e=document.querySelectorAll(t.map(e=>"link[rel="+e+"]").join(","));e.length>0&&Array.from(e).map(e=>{const t=e.getAttribute("href"),n={action:"cache",url:t};navigator.serviceWorker.controller.postMessage(n)})}}navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(()=>{console.log("Service Worker Registered")}),navigator.serviceWorker.ready.then(()=>{e&&prefetchCache()})}</script></body></html>