<!doctype html><html lang=pt-br>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/manifest.json>
<meta name=theme-color content="#ffffff">
<meta name=msapplication-TileColor content="#da532c">
<title>SDL 2 - Como lidar com eventos únicos do teclado</title>
<meta name=description content="Recurso util para implementar sistemas de pulo em SDL 2">
<meta name=keywords content="Programação,Tutoriais">
<link rel=stylesheet href=/assets/main.css>
<link rel=stylesheet href=/assets/molokai.css>
<link rel=canonical href=https://wldomiciano.com/sdl-2-como-lidar-com-eventos-unicos-do-teclado/>
<link rel=alternate type=application/rss+xml title="Wellington Domiciano" href=/index.xml>
<style>.video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.video-responsive iframe{left:0;top:0;height:100%;width:100%;position:absolute}</style>
<script>window.doNotTrack==="1"||navigator.doNotTrack==="1"||navigator.doNotTrack==="yes"||navigator.msDoNotTrack==="1"||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-48568115-1","auto"),ga("send","pageview"))</script>
</head>
<body>
<header class=site-header role=banner>
<div class=wrapper>
<a class=site-title rel=author href=https://wldomiciano.com/>Wellington Domiciano</a>
</div>
</header>
<main class=page-content aria-label=Content>
<div class=wrapper>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"blogPosting","datePublished":"2017-11-06","dateModified":"2017-11-06","name":"SDL 2 - Como lidar com eventos únicos do teclado","headline":"Recurso util para implementar sistemas de pulo em SDL 2","author":{"@type":"Person","name":"Wellington Domiciano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wldomiciano.com\/"},"publisher":{"@type":"Organization","name":"Wellington Domiciano"}}</script>
<article class="post h-entry">
<header class=post-header>
<h1 class="post-title p-name">SDL 2 - Como lidar com eventos únicos do teclado</h1>
<div class=post-meta>
<time class=dt-published datetime=2017-11-06T00:00:00Z>
November 6, 2017
</time>
</div>
<div class=post-tag-list>
<a class=post-tag-item href=https://wldomiciano.com/tags/sdl-2/>SDL 2</a>
</div>
</header>
<div class="post-content e-content">
<p>
</p>
<p>Em <a href=https://www.libsdl.org/ target=_blank rel=noopener>SDL</a>, quando queremos tratar eventos, usamos uma função parecida com a do trecho abaixo dentro do nosso <a href=https://en.wikipedia.org/wiki/Game_programming#Game_structure target=_blank rel=noopener><em>game loop</em></a>.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>handleInput</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>SDL_Event</span> <span class=n>event</span><span class=p>;</span>
    <span class=k>while</span> <span class=p>(</span><span class=n>SDL_PollEvent</span><span class=p>(</span><span class=o>&amp;</span><span class=n>event</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=n>type</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=nl>SDL_QUIT</span><span class=p>:</span>
                <span class=n>quit</span> <span class=o>=</span> <span class=n>SDL_TRUE</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=nl>SDL_KEYDOWN</span><span class=p>:</span>
                <span class=c1>// do something
</span><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=nl>SDL_KEYUP</span><span class=p>:</span>
                <span class=c1>// do something
</span><span class=c1></span>                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>Mas há momentos em que queremos tratar certos eventos (no caso, eventos de teclado) fora dessa função, e para esses momentos o SDL nos fornece a <a href=https://wiki.libsdl.org/SDL_GetKeyboardState target=_blank rel=noopener><code>SDL_GetKeyboardState()</code></a>, que podemos &ldquo;embrulhar&rdquo; numa outra função pra ficar mais amigável.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=c1>// A tecla está pressionada?
</span><span class=c1></span><span class=n>SDL_bool</span> <span class=nf>isKeyPressed</span><span class=p>(</span><span class=kt>int</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>SDL_GetKeyboardState</span><span class=p>(</span><span class=nb>NULL</span><span class=p>)</span> <span class=p>[</span><span class=n>key</span><span class=p>];</span>
<span class=p>}</span>
</code></pre></div><p>Um exemplo simples seria fazer o personagem pular ao pressionarmos a tecla de espaço.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=k>if</span> <span class=p>(</span> <span class=n>isKeyPressed</span><span class=p>(</span><span class=n>SDL_SCANCODE_SPACE</span><span class=p>)</span> <span class=p>)</span>
    <span class=n>player</span><span class=p>.</span><span class=n>y</span> <span class=o>-=</span> <span class=n>JUMP_FORCE</span><span class=p>;</span>
</code></pre></div><p>O problema com o trecho acima é que, enquanto a tecla de espaço estiver pressionada, nosso personagem continuará a subir indefinidamente.</p>
<p>O comportamento que desejamos aqui é que, ao pressionarmos &ldquo;espaço&rdquo;, o personagem realize o pulo e o encerre normalmente e só seja capaz de pular novamente caso paremos de apertar e a apertemos novamente.</p>
<p>A solução que encontrei foi a seguinte:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=c1>// Variável global
</span><span class=c1></span><span class=n>Uint8</span> <span class=n>keyStates</span><span class=p>[</span><span class=n>SDL_NUM_SCANCODES</span><span class=p>];</span>

<span class=c1>// Reinicia estados
</span><span class=c1></span><span class=kt>void</span> <span class=nf>resetKeyStates</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>for</span> <span class=p>(</span><span class=n>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>SDL_NUM_SCANCODES</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
        <span class=n>keyStates</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>

<span class=c1>// A tecla foi pressinada?
</span><span class=c1></span><span class=n>Uint8</span> <span class=nf>wasKeyPressed</span><span class=p>(</span><span class=kt>int</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>keyStates</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span><span class=p>;</span>
<span class=p>}</span>

<span class=c1>// A tecla foi liberada?
</span><span class=c1></span><span class=n>Uint8</span> <span class=nf>wasKeyReleased</span><span class=p>(</span><span class=kt>int</span> <span class=n>key</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=n>keyStates</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>==</span> <span class=mi>2</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>O próximo passo é modificar um pouco o nosso loop de eventos:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>void</span> <span class=nf>handleInput</span><span class=p>()</span> <span class=p>{</span>
    <span class=n>resetKeyStates</span><span class=p>();</span>
    <span class=n>SDL_Event</span> <span class=n>event</span><span class=p>;</span>
    <span class=k>while</span> <span class=p>(</span><span class=n>SDL_PollEvent</span><span class=p>(</span><span class=o>&amp;</span><span class=n>event</span><span class=p>))</span> <span class=p>{</span>
        <span class=k>switch</span> <span class=p>(</span><span class=n>event</span><span class=p>.</span><span class=n>type</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>case</span> <span class=nl>SDL_QUIT</span><span class=p>:</span>
                <span class=n>quit</span> <span class=o>=</span> <span class=n>SDL_TRUE</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=nl>SDL_KEYDOWN</span><span class=p>:</span>
                <span class=n>keyStates</span><span class=p>[</span><span class=n>event</span><span class=p>.</span><span class=n>key</span><span class=p>.</span><span class=n>keysym</span><span class=p>.</span><span class=n>scancode</span><span class=p>]</span> <span class=o>=</span> <span class=o>!</span><span class=n>event</span><span class=p>.</span><span class=n>key</span><span class=p>.</span><span class=n>repeat</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
            <span class=k>case</span> <span class=nl>SDL_KEYUP</span><span class=p>:</span>
                <span class=n>keyStates</span><span class=p>[</span><span class=n>event</span><span class=p>.</span><span class=n>key</span><span class=p>.</span><span class=n>keysym</span><span class=p>.</span><span class=n>scancode</span><span class=p>]</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
                <span class=k>break</span><span class=p>;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>E pronto. Faça o teste com isso:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>*</span><span class=n>argv</span><span class=p>[])</span> <span class=p>{</span>
    <span class=n>SDL_Init</span><span class=p>(</span><span class=n>SDL_INIT_VIDEO</span><span class=p>);</span>
    <span class=n>SDL_Window</span><span class=o>*</span> <span class=n>window</span> <span class=o>=</span> <span class=n>SDL_CreateWindow</span><span class=p>(</span><span class=s>&#34;Window Title&#34;</span><span class=p>,</span> <span class=n>SDL_WINDOWPOS_CENTERED</span><span class=p>,</span> <span class=n>SDL_WINDOWPOS_CENTERED</span><span class=p>,</span> <span class=mi>640</span><span class=p>,</span> <span class=mi>480</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>

    <span class=k>while</span> <span class=p>(</span> <span class=o>!</span><span class=n>quit</span> <span class=p>)</span> <span class=p>{</span>
        <span class=n>handleInput</span><span class=p>();</span>

        <span class=k>if</span> <span class=p>(</span> <span class=n>isKeyPressed</span><span class=p>(</span><span class=n>SDL_SCANCODE_A</span><span class=p>)</span> <span class=p>)</span>
            <span class=n>SDL_Log</span><span class=p>(</span><span class=s>&#34;A is pressed!&#34;</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span> <span class=n>wasKeyPressed</span><span class=p>(</span><span class=n>SDL_SCANCODE_SPACE</span><span class=p>)</span> <span class=p>)</span>
            <span class=n>SDL_Log</span><span class=p>(</span><span class=s>&#34;Space was pressed!&#34;</span><span class=p>);</span>

        <span class=k>if</span> <span class=p>(</span> <span class=n>wasKeyReleased</span><span class=p>(</span><span class=n>SDL_SCANCODE_SPACE</span><span class=p>)</span> <span class=p>)</span>
            <span class=n>SDL_Log</span><span class=p>(</span><span class=s>&#34;Space was released!&#34;</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=n>SDL_DestroyWindow</span><span class=p>(</span><span class=n>window</span><span class=p>);</span>
    <span class=n>SDL_Quit</span><span class=p>();</span>
    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
<span class=p>}</span>
</code></pre></div><p>O código de teste acima está completo aqui: <a href=https://gist.github.com/wldomiciano/26ca464b697e61d6bc85f2b07026631e target=_blank rel=noopener>test.c</a></p>
<p>E aqui tem um exemplo mais visual: <a href=https://gist.github.com/wldomiciano/533f83bd399409ef723beff401fa22f2 target=_blank rel=noopener>game.c</a></p>
</div>
<div id=disqus_thread></div>
<script>var disqus_config=function(){this.page.url="https://wldomiciano.com/sdl-2-como-lidar-com-eventos-unicos-do-teclado/",this.page.identifier="https://wldomiciano.com/sdl-2-como-lidar-com-eventos-unicos-do-teclado/"};(function(){var a=document,b=a.createElement("script");b.src="https://wldomiciano.disqus.com/embed.js",b.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(b)})()</script>
<noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript>
</article>
</div>
</main>
<footer class="site-footer h-card">
<div class=wrapper>
<div class=footer-col-wrapper>
<ul class=social-media-list>
<li>
<a href=https://github.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"/></svg>
<span class=username>wldomiciano</span></a>
</li>
<li>
<a href=https://twitter.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"/></svg>
<span class=username>wldomiciano</span></a>
</li>
</ul>
</div>
</div>
</footer>
<script>if("serviceWorker"in navigator){const a=!0,b=["index","next","prev","prefetch"];function prefetchCache(){if(navigator.serviceWorker.controller){const a=document.querySelectorAll(b.map(a=>"link[rel="+a+"]").join(","));a.length>0&&Array.from(a).map(a=>{const b=a.getAttribute("href"),c={action:"cache",url:b};navigator.serviceWorker.controller.postMessage(c)})}}navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(()=>{console.log("Service Worker Registered")}),navigator.serviceWorker.ready.then(()=>{a&&prefetchCache()})}</script>
</body>
</html>