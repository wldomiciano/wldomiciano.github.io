<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><title>O que são os Compound Literals em C</title>
<meta name=description content='Descubra o que é e como utilizar este recurso da linguagem C'><meta name=keywords content='Programação,Tutoriais'><link rel=stylesheet href=/assets/main.css><link rel=stylesheet href=/assets/molokai.css><link rel=canonical href=https://wldomiciano.com/o-que-sao-compound-literals-em-c/><link rel=alternate type=application/rss+xml title="Wellington Domiciano" href=/index.xml><style>.video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.video-responsive iframe{left:0;top:0;height:100%;width:100%;position:absolute}</style><script>window.doNotTrack==="1"||navigator.doNotTrack==="1"||navigator.doNotTrack==="yes"||navigator.msDoNotTrack==="1"||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-48568115-1","auto"),ga("send","pageview"))</script></head><body><header class=site-header role=banner><div class=wrapper><a class=site-title rel=author href=https://wldomiciano.com/>Wellington Domiciano</a></div></header><main class=page-content aria-label=Content><div class=wrapper><script type=application/ld+json>{"@context":"https://schema.org","@type":"blogPosting","datePublished":"2019-02-24","dateModified":"2019-02-24","name":"O que são os Compound Literals em C","headline":"Descubra o que é e como utilizar este recurso da linguagem C","author":{"@type":"Person","name":"Wellington Domiciano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wldomiciano.com\/"},"publisher":{"@type":"Organization","name":"Wellington Domiciano"}}</script><article class="post h-entry"><header class=post-header><h1 class="post-title p-name">O que são os Compound Literals em C</h1><div class=post-meta>Postado em
<time class=dt-published datetime=2019-02-24>24/02/2019</time></div><div class=post-tag-list><a class=post-tag-item href=https://wldomiciano.com/tags/c/>C</a></div></header><div class="post-content e-content"><p>Você já ouviu falar sobre <em>Compound Literals</em> em C?</p><p>O nome pode lhe ser estranho, mas há grandes chances de que você já tenha usado este recurso.</p><p>Ele faz parte da linguagem desde o C99 e se ainda não o conhece, eu vou te explicar.</p><p>Imagina que você tem uma <code>struct</code> chamada <code>Point</code> e uma função capaz de somar dois Points.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>Point</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Point</span> <span class=nf>sumPoints</span><span class=p>(</span><span class=n>Point</span> <span class=n>a</span><span class=p>,</span> <span class=n>Point</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Point</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>a</span><span class=p>.</span><span class=n>x</span> <span class=o>+</span> <span class=n>b</span><span class=p>.</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>a</span><span class=p>.</span><span class=n>y</span> <span class=o>+</span> <span class=n>b</span><span class=p>.</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ao invocar a função acima, você é obrigado a fornecer 2 Points válidos. Então, teríamos que fazer algo assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Point</span> <span class=n>a</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>Point</span> <span class=n>b</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span> <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=n>Point</span> <span class=n>c</span> <span class=o>=</span> <span class=nf>sumPoints</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>);</span>
</span></span></code></pre></div><p>Só que em alguns momentos pode não ser desejável ter que criar os 2 Points só pra poder passá-los para a função e é aí que entra os Compound Literals.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Point</span> <span class=n>d</span> <span class=o>=</span> <span class=nf>sumPoints</span><span class=p>((</span><span class=n>Point</span><span class=p>)</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span> <span class=p>},</span> <span class=p>(</span><span class=n>Point</span><span class=p>)</span> <span class=p>{</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span> <span class=p>});</span>
</span></span></code></pre></div><p>Por definição eles são <strong>objetos sem nome</strong> representados pelo <strong>nome de um tipo entre parenteses</strong> seguido por uma <strong>lista de inicializadores entre chaves</strong>.</p><p>Se uma função aceita ponteiros, também podemos usar os Compound Literals.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>Point</span> <span class=nf>sumPointPointers</span><span class=p>(</span><span class=n>Point</span><span class=o>*</span> <span class=n>a</span><span class=p>,</span> <span class=n>Point</span><span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Point</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>a</span><span class=o>-&gt;</span><span class=n>x</span> <span class=o>+</span> <span class=n>b</span><span class=o>-&gt;</span><span class=n>x</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>.</span><span class=n>y</span> <span class=o>=</span> <span class=n>a</span><span class=o>-&gt;</span><span class=n>y</span> <span class=o>+</span> <span class=n>b</span><span class=o>-&gt;</span><span class=n>y</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Point</span> <span class=n>e</span> <span class=o>=</span> <span class=nf>sumPointPointers</span><span class=p>(</span><span class=o>&amp;</span><span class=p>(</span><span class=n>Point</span><span class=p>)</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span> <span class=p>},</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>Point</span><span class=p>)</span> <span class=p>{</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span> <span class=p>});</span>
</span></span></code></pre></div><p>Também é possível criar compound literals de arrays.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=nf>someFunction</span><span class=p>(</span> <span class=p>(</span><span class=kt>int</span><span class=p>[])</span> <span class=p>{</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>5</span> <span class=p>}</span> <span class=p>);</span>
</span></span></code></pre></div><p>Estes objetos são criados automaticamente.</p><p>Se eles forem usados <strong>fora</strong> do corpo de uma função, eles possuem <em>static storage duration</em> e isso quer dizer que eles duram por toda a execução do programa.</p><p>Mas se forem usados <strong>dentro</strong> do corpo de uma função, eles possuem <em>automatic storage duration</em> e isso que dizer que seu tempo de vida dura até que a função retorne.</p><p>Você pode ter informações detalhadas consultando a própria especificação da linguagem. No capitulo <strong>6.5.2.5 Compound Literals</strong>.</p><p>O último rascunho está publicamente disponível e pode ser acessado pelo link abaixo.</p><p><a href=http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf target=_blank rel=noopener>http://www.open-std.org/jtc1/sc22/wg14/www/docs/n1570.pdf</a></p><h2 id=considerações-finais>Considerações finais</h2><p>Particularmente achei bem legal esse recurso, pois há um tempo eu queria criar um framework para criação de jogos 2D baseado em <a href=https://www.libsdl.org/ target=_blank rel=noopener>SDL 2</a> onde haveria uma função chamada <code>createGame()</code> que aceitava uma uma série de configurações como argumento.</p><p>Através dessas configurações, era possível escolher, dentre outras coisas, a altura e a largura da janela.</p><p>Eu queria algo simples ao estilo do <a href=http://phaser.io/ target=_blank rel=noopener>Phaser.io</a> e consegui algo semelhante assim:</p><p>As configurações eram representadas pela struct <code>Config</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>width</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>height</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>*</span> <span class=n>title</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>Config</span><span class=p>;</span>
</span></span></code></pre></div><p>E para criar inicializar o framework, era só fazer assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;framework.h&#34;;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>Game</span> <span class=n>game</span> <span class=o>=</span> <span class=nf>createGame</span><span class=p>((</span><span class=n>Config</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>title</span> <span class=o>=</span> <span class=s>&#34;My Awesome Game&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>width</span> <span class=o>=</span> <span class=mi>640</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>.</span><span class=n>height</span> <span class=o>=</span> <span class=mi>480</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nf>runGame</span><span class=p>(</span><span class=o>&amp;</span><span class=n>game</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Achei a ideia bem legal embora o framework não tenha ido pra frente.</p><p>Criei uma demonstração mínima que pode ser executada aqui:</p><p><a href=https://repl.it/@wldomiciano/compoundListeralDemonstration target=_blank rel=noopener>https://repl.it/@wldomiciano/compoundListeralDemonstration</a></p><p>Mas e você, já conhecia este recurso? Sabia que seu nome era esse?</p><p>Espero que este artigo tenha sido útil. Até a próxima!</p></div><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://wldomiciano.com/o-que-sao-compound-literals-em-c/",this.page.identifier="https://wldomiciano.com/o-que-sao-compound-literals-em-c/"};(function(){var e=document,t=e.createElement("script");t.src="https://wldomiciano.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></article></div></main><footer class="site-footer h-card"><div class=wrapper><div class=footer-col-wrapper><ul class=social-media-list><li><a href=https://github.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"/></svg>
<span class=username>wldomiciano</span></a></li><li><a href=https://twitter.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"/></svg>
<span class=username>wldomiciano</span></a></li></ul></div></div></footer><script>if("serviceWorker"in navigator){const e=!0,t=["index","next","prev","prefetch"];function prefetchCache(){if(navigator.serviceWorker.controller){const e=document.querySelectorAll(t.map(e=>"link[rel="+e+"]").join(","));e.length>0&&Array.from(e).map(e=>{const t=e.getAttribute("href"),n={action:"cache",url:t};navigator.serviceWorker.controller.postMessage(n)})}}navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(()=>{console.log("Service Worker Registered")}),navigator.serviceWorker.ready.then(()=>{e&&prefetchCache()})}</script></body></html>