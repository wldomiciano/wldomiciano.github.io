<!doctype html><html lang=pt-br><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><title>SDL 2 - Como misturar texto com números usando SDL_ttf</title><meta name=description content="Veja como usar funções padrões do C junto com a SDL_ttf para criar uma função gráfica semelhante a printf"><meta name=keywords content="Programação,Tutoriais"><link rel=stylesheet href=/assets/main.css><link rel=stylesheet href=/assets/molokai.css><link rel=canonical href=https://wldomiciano.com/sdl-2-como-misturar-texto-com-numeros-sdl-ttf/><link rel=alternate type=application/rss+xml title="Wellington Domiciano" href=/index.xml><style>.video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.video-responsive iframe{left:0;top:0;height:100%;width:100%;position:absolute}</style><script>window.doNotTrack==="1"||navigator.doNotTrack==="1"||navigator.doNotTrack==="yes"||navigator.msDoNotTrack==="1"||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-48568115-1","auto"),ga("send","pageview"))</script></head><body><header class=site-header role=banner><div class=wrapper><a class=site-title rel=author href=https://wldomiciano.com/>Wellington Domiciano</a></div></header><main class=page-content aria-label=Content><div class=wrapper><script type=application/ld+json>{"@context":"https://schema.org","@type":"blogPosting","datePublished":"2017-11-05","dateModified":"2018-09-12","name":"SDL 2 - Como misturar texto com números usando SDL_ttf","headline":"Veja como usar funções padrões do C junto com a SDL_ttf para criar uma função gráfica semelhante a printf","author":{"@type":"Person","name":"Wellington Domiciano"},"mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wldomiciano.com\/"},"publisher":{"@type":"Organization","name":"Wellington Domiciano"}}</script><article class="post h-entry"><header class=post-header><h1 class="post-title p-name">SDL 2 - Como misturar texto com números usando SDL_ttf</h1><div class=post-meta>Postado em
<time class=dt-published datetime=2017-11-05>November 5, 2017</time>
• Atualizado em
<time class=dt-updated datetime=2018-09-12>September 12, 2018</time></div><div class=post-tag-list><a class=post-tag-item href=https://wldomiciano.com/tags/sdl-2/>SDL 2</a></div></header><div class="post-content e-content"><p>Usar a biblioteca <a href=https://www.libsdl.org/projects/SDL_ttf target=_blank rel=noopener>SDL_ttf</a> (com <a href=https://www.libsdl.org target=_blank rel=noopener>SDL 2</a>) não tem segredo.</p><ol><li>Você inicializa com <code>TTF_Init()</code></li><li>Carrega uma fonte com <code>TTF_OpenFont()</code></li><li>Cria um texto com <code>TTF_RenderText_Solid()</code></li><li>E desenha na tela com <code>SDL_BlitSurface()</code></li></ol><p>Olha um exemplo <a href=https://gist.github.com/wldomiciano/c7fecb4e7af1cd57342390b22800c771 target=_blank rel=noopener>aqui neste gist</a>.</p><blockquote><p>Obs.: Para usar os exemplo deste artigo é necessário que o arquivo <em>VT323.ttf</em> esteja na mesma pasta que os códigos.</p><p>Você pode baixar esta fonte neste link:
<a href=https://fonts.google.com/specimen/VT323 target=_blank rel=noopener>https://fonts.google.com/specimen/VT323</a></p><p>Renomeie o arquivo baixado caso seja necessário.</p></blockquote><p>Este tipo de dado muda constantemente e o pior: mistura números e texto!</p><p>Como você faria pra escrever, por exemplo, &ldquo;Your Score: 123&rdquo;?</p><p>Se estivéssemos lidando com <code>printf()</code> e console seria fácil:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>printf</span><span class=p>(</span><span class=s>&#34;Your Score: %d&#34;</span><span class=p>,</span> <span class=n>score</span><span class=p>);</span>
</span></span></code></pre></div><p>Então a solução para esse problema é o <a href=http://www.cplusplus.com/reference/cstdio/snprintf/ target=_blank rel=noopener><code>snprintf()</code></a>.</p><p>A diferença do <code>snprintf</code> é que ao invés de imprimir texto na saída padrão, ele armazena o texto gerado em um array.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>snprintf</span><span class=p>(</span><span class=n>BUFFER</span><span class=p>,</span> <span class=n>BUFFER_SIZE</span><span class=p>,</span> <span class=s>&#34;Your Score: %d&#34;</span><span class=p>,</span> <span class=mi>123</span><span class=p>);</span>
</span></span></code></pre></div><p>Depois é só fazer o que quiser com o BUFFER. Experimente com:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define BUFFER_SIZE 512
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=n>BUFFER_SIZE</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>snprintf</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>BUFFER_SIZE</span><span class=p>,</span> <span class=s>&#34;Your Score: %d&#34;</span><span class=p>,</span> <span class=mi>123</span><span class=p>);</span> <span class=c1>// armazena em buffer
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>printf</span><span class=p>(</span><span class=n>buffer</span><span class=p>);</span> <span class=c1>// imprime o resultado na saida padrão
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Voltando pro nosso problema em SDL, poderíamos alterar o código mostrado no inicio pro <code>while</code> ficar assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>counter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>SDL_QuitRequested</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=mi>512</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>SDL_snprintf</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=mi>512</span><span class=p>,</span> <span class=s>&#34;Your Score: %d&#34;</span><span class=p>,</span> <span class=n>counter</span><span class=o>++</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_Surface</span><span class=o>*</span> <span class=n>text</span> <span class=o>=</span> <span class=n>TTF_RenderText_Solid</span><span class=p>(</span><span class=n>font</span><span class=p>,</span> <span class=n>buffer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>(</span><span class=n>SDL_Color</span><span class=p>)</span> <span class=p>{</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_FillRect</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>SDL_BlitSurface</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>surface</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>SDL_FreeSurface</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_UpdateWindowSurface</span><span class=p>(</span><span class=n>window</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Isso resolve o problema e nos permite criar texto como se estivéssemos usando usando <code>printf</code>, mas nós podemos ir um pouco mais além. Que tal criar uma função que nos permita deixar nosso loop assim:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=o>!</span><span class=n>SDL_QuitRequested</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>SDL_FillRect</span><span class=p>(</span><span class=n>surface</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>drawText</span><span class=p>(</span><span class=s>&#34;Your Score: %d&#34;</span><span class=p>,</span> <span class=n>counter</span><span class=o>++</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_UpdateWindowSurface</span><span class=p>(</span><span class=n>window</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Para isso vamos precisar de mais uma função da biblioteca padrão, a <a href=http://www.cplusplus.com/reference/cstdio/vsnprintf/ target=_blank rel=noopener><code>vsnprintf()</code></a>. Ela aceita como último argumento uma <code>va_list</code>, aquela estrutura que usamos quando queremos criar uma função que aceita uma quantidade variável de argumentos.</p><p>Com ela podemos criar a seguinte função:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#define MAX_LENGTH 1024
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>drawText</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span><span class=o>*</span> <span class=n>fmt</span><span class=p>,</span> <span class=p>...)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>buffer</span><span class=p>[</span><span class=n>MAX_LENGTH</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>va_list</span> <span class=n>ap</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>va_start</span> <span class=p>(</span><span class=n>ap</span><span class=p>,</span> <span class=n>fmt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_vsnprintf</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=n>MAX_LENGTH</span><span class=p>,</span> <span class=n>fmt</span><span class=p>,</span> <span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>va_end</span> <span class=p>(</span><span class=n>ap</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_Surface</span><span class=o>*</span> <span class=n>text</span> <span class=o>=</span> <span class=n>TTF_RenderText_Solid</span><span class=p>(</span><span class=n>font</span><span class=p>,</span> <span class=n>buffer</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=p>(</span><span class=n>SDL_Color</span><span class=p>)</span> <span class=p>{</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>SDL_BlitSurface</span><span class=p>(</span><span class=n>text</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>,</span> <span class=n>surface</span><span class=p>,</span> <span class=nb>NULL</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>SDL_FreeSurface</span><span class=p>(</span><span class=n>text</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Tem outro gist com o <a href=https://gist.github.com/wldomiciano/d16bea2d66365cf0113c7abaa0b84de7 target=_blank rel=noopener>resultado final aqui</a></p><p><strong>UPDATE (12/09/18):</strong><br>Usei o exemplo anterior para fazer uma versão usando renderer. O gist com <a href=https://gist.github.com/wldomiciano/316b9b6fd2ecc5b1af76005e76691c42 target=_blank rel=noopener>o código é este</a></p></div><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://wldomiciano.com/sdl-2-como-misturar-texto-com-numeros-sdl-ttf/",this.page.identifier="https://wldomiciano.com/sdl-2-como-misturar-texto-com-numeros-sdl-ttf/"};(function(){var e=document,t=e.createElement("script");t.src="https://wldomiciano.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></article></div></main><footer class="site-footer h-card"><div class=wrapper><div class=footer-col-wrapper><ul class=social-media-list><li><a href=https://github.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"/></svg><span class=username>wldomiciano</span></a></li><li><a href=https://twitter.com/wldomiciano><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"/></svg><span class=username>wldomiciano</span></a></li></ul></div></div></footer><script>if("serviceWorker"in navigator){const e=!0,t=["index","next","prev","prefetch"];function prefetchCache(){if(navigator.serviceWorker.controller){const e=document.querySelectorAll(t.map(e=>"link[rel="+e+"]").join(","));e.length>0&&Array.from(e).map(e=>{const t=e.getAttribute("href"),n={action:"cache",url:t};navigator.serviceWorker.controller.postMessage(n)})}}navigator.serviceWorker.register("/sw.js",{scope:"/"}).then(()=>{console.log("Service Worker Registered")}),navigator.serviceWorker.ready.then(()=>{e&&prefetchCache()})}</script></body></html>